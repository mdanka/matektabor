{% load staticfiles %}

<link rel="stylesheet/less" type="text/css" href="{% static 'barkochba/style.less' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'barkochba/lib/jquery.tokeninput-1.6.0/styles/token-input.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'barkochba/lib/jquery.tokeninput-1.6.0/styles/token-input-facebook.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'barkochba/lib/bootstrap-3.2.0/css/bootstrap.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'barkochba/lib/bootstrap-3.2.0/css/bootstrap-theme.css' %}" />

<script src="{% static 'barkochba/lib/jquery-2.1.1.js' %}" type="text/javascript"></script>
<script src="{% static 'barkochba/lib/jquery.tokeninput-1.6.0/src/jquery.tokeninput.js' %}" type="text/javascript"></script>
<script src="{% static 'barkochba/lib/less-1.7.5.js' %}" type="text/javascript"></script>
<script src="{% static 'barkochba/lib/underscore-1.7.0.js' %}" type="text/javascript"></script>
<script src="{% static 'barkochba/lib/bootstrap-3.2.0/js/bootstrap.js' %}" type="text/javascript"></script>

<script type="text/javascript">
function _namesChanged() {
	selectedPersonIdsString = $("#names-input").val();
	selectedPersonIds = _.map(selectedPersonIdsString.split(','), function (value) {
		return Number(value);
	});
	$('a.barkochba-story').each(function() {
		storyPersonIds = $(this).data("person-ids");
		heardStoryPersonIds = _.intersection(selectedPersonIds, storyPersonIds);
		hasHeardStory = heardStoryPersonIds.length > 0;
		if (hasHeardStory) {
			$(this).slideUp();
		} else {
			$(this).slideDown();
		}
	});
}

$(document).ready(function () {
    $("#names-input").tokenInput("{% url 'barkochba:person_search' %}", {
    	hintText: 'Keress egy személy nevére',
    	noResultsText: 'Nincs találat',
    	searchingText: 'Keresés...',
    	theme: 'facebook',
    	preventDuplicates: true,
    	onAdd: _namesChanged,
    	onDelete: _namesChanged
    });
});
</script>

<body>

	<div class="container">

		<div class="row">
			<div class="col-sm-12">
				<input id="names-input" />
			</div>
		</div>

		<div class="row">
			<div class="col-sm-4">
				<div class="list-group">
					{% for story_map in stories %}
					  <a href="#" class="list-group-item barkochba-story" data-person-ids="{{ story_map.person_ids_json }}">
					  	{{ story_map.story.order_number }} - {{ story_map.story.title }}
					  </a>
					{% endfor %}
				</div>
			</div>

			<div class="col-sm-8">
				<div class="panel panel-default">
					<div class="panel-heading">
						4 - Két nyuszi
					</div>
					<div class="panel-body">
					  <p>
					  	Egy cső fekszik a réten. Az egyik oldalon belenéz az egyik nyuszi, a másikon a másik nyuszi, mégsem látják egymást.
					  </p>
					  <p>
					  	A két nyuszi nem egyszerre nézett bele a csőbe.
					  </p>
					  <p>
					  	Szabó Marcell, Tokovics Dávid
					  </p>
					</div>
				</div>
			</div>
		</div>

	</div>

</body>